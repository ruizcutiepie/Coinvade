// prisma/schema.prisma

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

/* =======================
   ENUMS (production safety)
   ======================= */

enum Role {
  USER
  ADMIN
}

enum TradeDirection {
  LONG
  SHORT
}

enum DepositStatus {
  PENDING
  CONFIRMED
  FAILED
}

enum WithdrawStatus {
  PENDING
  APPROVED
  REJECTED
  PAID
}

/* =======================
   MODELS
   ======================= */

model User {
  id           String   @id @default(cuid())
  email        String   @unique
  name         String?
  passwordHash String?
  role         Role     @default(USER)
  createdAt    DateTime @default(now())

  wallets      Wallet[]
  trades       Trade[]
  deposits     DepositIntent[]
  withdrawals  WithdrawRequest[]
}

model Wallet {
  id        String   @id @default(cuid())
  user      User     @relation(fields: [userId], references: [id])
  userId    String

  /// Example: "BTC", "ETH", "USDT"
  coin      String

  /// IMPORTANT: use Decimal for money
  balance   Decimal  @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([userId, coin])
}

model Trade {
  id        String         @id @default(cuid())
  user      User           @relation(fields: [userId], references: [id])
  userId    String

  /// Example: "BTCUSDT"
  pair      String

  /// LONG or SHORT
  direction TradeDirection

  /// Stake in USDT (Decimal for money)
  amount    Decimal

  /// Contract duration in seconds
  duration  Int

  // Prices (Decimal for accuracy)
  entryPrice Decimal?
  exitPrice  Decimal?
  closePrice Decimal?

  // Result
  won        Boolean?
  payout     Decimal        @default(0)

  createdAt  DateTime       @default(now())
  resolvedAt DateTime?
}

model DepositIntent {
  id        String        @id @default(cuid())
  user      User          @relation(fields: [userId], references: [id])
  userId    String

  coin      String
  network   String

  txHash    String?
  amount    Decimal?

  status    DepositStatus @default(PENDING)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model WithdrawRequest {
  id        String         @id @default(cuid())
  user      User           @relation(fields: [userId], references: [id])
  userId    String

  coin      String
  network   String
  address   String

  amount    Decimal
  note      String?

  status    WithdrawStatus @default(PENDING)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
